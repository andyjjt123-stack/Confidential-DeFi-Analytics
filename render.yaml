services:
  # ① Spring Boot 後端（Web Service, Docker）
  - type: web
    name: cda-backend
    env: docker
    plan: free
    autoDeploy: true
    dockerContext: ./backend
    dockerfilePath: ./backend/Dockerfile
    envVars:
      - key: JAVA_TOOL_OPTIONS
        value: "-XX:MaxRAMPercentage=75.0"
      - key: STABLE_RPC_URL
        sync: false
      - key: PRIVATE_KEY
        sync: false
      - key: CONTRACT_ADDRESS
        sync: false
      - key: CHAIN_ID
        value: "2201"

  # ② Vite 前端（Static Site）
  - type: static_site          # ← 這裡要叫 static_site
    name: cda-frontend
    buildCommand: "cd frontend && npm ci && npm run build"
    staticPublishPath: "frontend/dist"
    envVars:
      - key: NODE_VERSION
        value: "20"
      - key: VITE_API_BASE
        sync: false           # 等後端 Live 後再填入後端公開 URL
    routes:
      - type: rewrite
        source: /.*
        destination: /index.html
